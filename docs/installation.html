<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; mpieva/quicksand v1.5 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage" href="usage.html" />
    <link rel="prev" title="Description" href="description.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> mpieva/quicksand
          </a>
              <div class="version">
                v1.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download-repository">Download repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-runabilty">03. Test Runabilty</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-datastructure">04. Setup Datastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-real-data">05. Run real Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="quicksand-build.html">quicksand-build</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mpieva/quicksand</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<span id="install-page"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"></a></h1>
<p>In the case that the <a class="reference internal" href="quickstart.html#quickstart-page"><span class="std std-ref">Quickstart</span></a> didnt work, this section will walk you through the stages of downloading, installing and
testing the quicksand pipeline in more detail.</p>
<section id="requirements">
<span id="id1"></span><h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"></a></h2>
<p>Make sure you have the following two components installed.</p>
<dl class="field-list simple">
<dt class="field-odd">Nextflow</dt>
<dd class="field-odd"><p>See more details here: <a class="reference external" href="https://www.nextflow.io/docs/latest/getstarted.html">Nextflow</a></p>
</dd>
<dt class="field-even">Singularity or Docker</dt>
<dd class="field-even"><p>See more details here: <a class="reference external" href="https://sylabs.io/guides/3.0/user-guide/installation.html">Singularity</a> or <a class="reference external" href="https://docs.docker.com/get-docker/">Docker</a></p>
</dd>
</dl>
<p>Nextflow is the pipeline framework, while Singularity/Docker are software tools for the containerization of code.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>check the successful installation of the software by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="o">-</span><span class="n">v</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">nextflow</span> <span class="n">version</span> <span class="mf">20.04.1.5335</span>
<span class="n">singularity</span> <span class="o">--</span><span class="n">version</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">singularity</span> <span class="n">version</span> <span class="mf">3.7.2</span><span class="o">-</span><span class="n">dirty</span>
</pre></div>
</div>
</div>
</section>
<section id="download-repository">
<h2>Download repository<a class="headerlink" href="#download-repository" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">The code for the quicksand pipeline is hosted on <a class="reference external" href="https://github.com/mpieva/quicksand">Github</a>.</div>
<div class="line">Clone the repository by typing</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">pipeline</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">pipeline</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mpieva</span><span class="o">/</span><span class="n">quicksand</span>
</pre></div>
</div>
<p>This code creates a new directory <code class="file docutils literal notranslate"><span class="pre">pipeline</span></code> that will contain all the data produced over the course of this setup process. Here - the cloned github repository.</p>
</section>
<section id="test-runabilty">
<h2>03. Test Runabilty<a class="headerlink" href="#test-runabilty" title="Permalink to this headline"></a></h2>
<p>With the requirements met, the pipeline can be tested.
To do that, unpack the test database provided in the repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">testrun</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">testrun</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvzf</span> <span class="o">../</span><span class="n">quicksand</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">kraken</span><span class="o">/</span><span class="n">database</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>This will create a directory <code class="file docutils literal notranslate"><span class="pre">TestDB</span></code> in the current folder.</p>
<p>To ensure a stable environment, the pipeline runs within a container that gets
downloaded from the internet, from <a class="reference external" href="https://hub.docker.com/r/merszym/quicksand">Dockerhub</a>.
The Dockerfile used to build that image can be found within the <code class="file docutils literal notranslate"><span class="pre">quicksand/docker</span></code> directory of the repository.</p>
<p>To save the downloaded image at an accessible place, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd ..
mkdir singularity
export NXF_SINGULARITY_CACHEDIR=$PWD/singularity
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case some files are later stored or read from a shared drive, make sure
that Singularity has the permissions to overlay and access that file-system within the
container. The pipeline will otherwise not be able to read from or write to it.
To avoid a “file doesn’t exist” error, create an additional
config-file and bind the paths into the container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nano</span> <span class="n">singularity</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
<p>Add the following content to the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">singularity</span> <span class="p">{</span>
  <span class="n">runOptions</span> <span class="o">=</span> <span class="s2">&quot;--bind /path/to/shared/disc&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To save and close nano, press <kbd class="kbd docutils literal notranslate">ctrl</kbd> + <kbd class="kbd docutils literal notranslate">x</kbd> and confirm with <kbd class="kbd docutils literal notranslate">y</kbd>.</p>
<p>Add this file to your nextflow run with the <code class="code docutils literal notranslate"><span class="pre">-c</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="o">...</span> <span class="o">-</span><span class="n">c</span> <span class="n">singularity</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
</div>
<p>Now the pipeline can be tested by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">testrun</span>
<span class="n">nextflow</span> <span class="n">run</span>    <span class="o">../</span><span class="n">quicksand</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">nf</span> \
    <span class="o">--</span><span class="n">split</span>     <span class="o">../</span><span class="n">quicksand</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">split</span><span class="o">/</span> \
    <span class="o">--</span><span class="n">genome</span>    <span class="o">../</span><span class="n">quicksand</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">genomes</span><span class="o">/</span> \
    <span class="o">--</span><span class="n">bedfiles</span>  <span class="o">../</span><span class="n">quicksand</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">masked</span><span class="o">/</span> \
    <span class="o">--</span><span class="n">db</span>        <span class="n">TestDB</span><span class="o">/</span> \
    <span class="o">--</span><span class="n">specmap</span>   <span class="o">../</span><span class="n">quicksand</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">genomes</span><span class="o">/</span><span class="n">specmap</span><span class="o">.</span><span class="n">tsv</span> \
    <span class="o">--</span><span class="n">analyze</span>   \
    <span class="o">--</span><span class="n">report</span>    \
    <span class="o">-</span><span class="n">c</span>          <span class="o">../</span><span class="n">singularity</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
<p>The meaning of the flags and the different ways of customizing the pipeline is described in the <a class="reference internal" href="usage.html#usage-page"><span class="std std-ref">Usage</span></a> section. In case of choosing Docker over Singularity, add <code class="code docutils literal notranslate"><span class="pre">-profile</span> <span class="pre">docker</span></code> to the command.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>the <code class="code docutils literal notranslate"><span class="pre">-profile</span></code> and the <code class="code docutils literal notranslate"><span class="pre">-c</span></code> flag has only one dash!</p>
</div>
<p>If the run was successful, several new files and directories will appear in your current working directory. To see an explanation of the files, see the <a class="reference internal" href="usage.html#output"><span class="std std-ref">Output</span></a> section.</p>
</section>
<section id="setup-datastructure">
<span id="setup"></span><h2>04. Setup Datastructure<a class="headerlink" href="#setup-datastructure" title="Permalink to this headline"></a></h2>
<p>To run the pipeline with a real database a certain datastructure is required.</p>
<ul class="simple">
<li><p>A preindexed Kraken-database</p></li>
<li><p>All Mammalian mitochondrial reference genomes from RefSeq in a fasta-format</p></li>
<li><p>Bedfiles for these genomes</p></li>
<li><p>A list that points to all species of a clade specified by the NCBI taxID</p></li>
</ul>
<p>Instead of creating this structure manually, a different pipeline is used
for that</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Refer to the README of <a class="reference external" href="https://github.com/mpieva/quicksand-build">that pipeline</a> for custom
settings of the data structure (e.g. kmer-sizes) and a more detailed explanation of the output.</p>
</div>
<p>The datastructure-pipeline can be started directly from the repository by tying:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">..</span>
<span class="n">nextflow</span> <span class="n">run</span> <span class="n">mpieva</span><span class="o">/</span><span class="n">quicksand</span><span class="o">-</span><span class="n">build</span> <span class="o">--</span><span class="n">outdir</span> <span class="n">data</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The creation of the preindexed kraken-databases requires ~50GB of RAM.
If the pipeline fails, make sure the computer fits the requirements!</p>
</div>
<p>This creates a folder “data” that contains all the database files required to run quicksand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>data
├── kraken
│    └── Mito_db_kmer22
├── genomes
│    ├── {family}
│    │    └── {species}.fasta
│    └── taxid_map.tsv
└── masked
     └── {species}.masked.bed
</pre></div>
</div>
<p>This datastructure can be used by quicksand with the following flags:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">db</span>         <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">kraken</span><span class="o">/</span><span class="n">Mito_db_kmer22</span><span class="o">/</span>
<span class="o">--</span><span class="n">genome</span>     <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">genomes</span><span class="o">/</span>
<span class="o">--</span><span class="n">bedfiles</span>   <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">masked</span><span class="o">/</span>
</pre></div>
</div>
</section>
<section id="run-real-data">
<h2>05. Run real Data<a class="headerlink" href="#run-real-data" title="Permalink to this headline"></a></h2>
<p>Before running the test, make sure you create a new directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">runDir</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">runDir</span>
</pre></div>
</div>
<p>For this testrun with real data, download the Hohlenstein-Stadel mtDNA (please see the <span id="id2">[README]</span>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">P</span> <span class="n">split</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ftp</span><span class="o">.</span><span class="n">eva</span><span class="o">.</span><span class="n">mpg</span><span class="o">.</span><span class="n">de</span><span class="o">/</span><span class="n">neandertal</span><span class="o">/</span><span class="n">Hohlenstein</span><span class="o">-</span><span class="n">Stadel</span><span class="o">/</span><span class="n">BAM</span><span class="o">/</span><span class="n">mtDNA</span><span class="o">/</span><span class="n">HST</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">ALL</span><span class="o">.</span><span class="n">bam</span>
</pre></div>
</div>
<p>And run the quicksand pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">quicksand</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">nf</span> \
    <span class="o">--</span><span class="n">db</span>        <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">kraken</span><span class="o">/</span><span class="n">Mito_db_kmer22</span> \
    <span class="o">--</span><span class="n">genome</span>    <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">genomes</span> \
    <span class="o">--</span><span class="n">bedfiles</span>  <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">masked</span> \
    <span class="o">--</span><span class="n">split</span>     <span class="n">split</span> \
    <span class="o">--</span><span class="n">report</span>    \
    <span class="o">--</span><span class="n">analyze</span>   \
    <span class="o">-</span><span class="n">c</span>          <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">singularity</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Please see the <a class="reference internal" href="usage.html#usage-page"><span class="std std-ref">Usage</span></a> section for an explaination of the flags and the input!</div>
<div class="line">Please see the <a class="reference internal" href="usage.html#output"><span class="std std-ref">Output</span></a> section for an explaination of the output files!</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="description.html" class="btn btn-neutral float-left" title="Description" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="usage.html" class="btn btn-neutral float-right" title="Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Merlin Szymanski.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>