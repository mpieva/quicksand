

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Configuration &mdash; quicksand v1.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contribute" href="contribute.html" />
    <link rel="prev" title="Usage" href="usage.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> quicksand
          

          
          </a>

          
            
            
              <div class="version">
                v1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="description.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#config-file">Config-file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#profiles">Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environmental-variables">Environmental variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#singularity">Singularity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conda">Conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="#intermediate-files">Intermediate files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">quicksand</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration">
<span id="configuration-page"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="config-file">
<span id="config"></span><h2>Config-file<a class="headerlink" href="#config-file" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>reduce the number of flags</strong></div>
<div class="line">Since most of the required flags won’t change across runs - like the <code class="code docutils literal notranslate"><span class="pre">--db</span></code> or the <code class="code docutils literal notranslate"><span class="pre">--genome</span></code> flag, it is recommended to create a custom <code class="file docutils literal notranslate"><span class="pre">nextflow.config</span></code> file or a wrapper script to hand default values for these parameters over to the pipeline. For the config-file, write down all the static parameter/flags (see example below) and hand the file over to the pipeline with the <code class="code docutils literal notranslate"><span class="pre">-c</span></code> flag:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nano</span> <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>

<span class="o">---</span> <span class="n">GNU</span> <span class="n">nano</span> <span class="o">---</span>
<span class="o">//</span><span class="n">add</span> <span class="n">parameters</span> <span class="n">to</span> <span class="n">the</span> <span class="n">pipeline</span>
<span class="n">params</span> <span class="p">{</span>
    <span class="n">db</span>         <span class="o">=</span> <span class="s2">&quot;~/pipeline/data/kraken/Mito_db_kmer22&quot;</span>
    <span class="n">genome</span>     <span class="o">=</span> <span class="s2">&quot;~/pipeline/data/genomes&quot;</span>
    <span class="n">bedfiles</span>   <span class="o">=</span> <span class="s2">&quot;~/pipeline/data/masked/&quot;</span>
    <span class="n">report</span>     <span class="o">=</span> <span class="n">true</span>
    <span class="n">analyze</span>    <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>

<span class="o">//</span><span class="n">add</span> <span class="n">singularity</span><span class="o">-</span><span class="n">parameters</span> <span class="n">to</span> <span class="n">the</span> <span class="n">pipeline</span>
<span class="o">//</span><span class="n">bind</span><span class="p">:</span> <span class="n">add</span> <span class="n">shared</span> <span class="n">drives</span> <span class="p">(</span><span class="k">if</span> <span class="n">necessary</span><span class="p">)</span>
<span class="o">//</span><span class="n">cacheDir</span><span class="p">:</span> <span class="n">where</span> <span class="n">to</span> <span class="n">download</span> <span class="n">the</span> <span class="n">container</span>
<span class="n">singularity</span><span class="p">{</span>
    <span class="n">runOptions</span> <span class="o">=</span> <span class="s2">&quot;--bind /mnt/&quot;</span>
    <span class="n">cacheDir</span>   <span class="o">=</span> <span class="s2">&quot;~/pipeline/singularity/&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>save the file by pressing <kbd class="kbd docutils literal notranslate">ctrl</kbd> + <kbd class="kbd docutils literal notranslate">x</kbd> and <kbd class="kbd docutils literal notranslate">y</kbd>. Then run the pipeline with the following parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="n">mpieva</span><span class="o">/</span><span class="n">quicksand</span> <span class="o">-</span><span class="n">c</span> <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span> <span class="o">--</span><span class="n">split</span> <span class="n">PATH</span><span class="o">/</span><span class="n">TO</span><span class="o">/</span><span class="n">INPUT</span><span class="o">/</span><span class="n">DATA</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>Global config-file</strong></div>
<div class="line">to avoid adding the <code class="code docutils literal notranslate"><span class="pre">-profile</span></code> flag to the command (in case one uses Docker or conda), it is possible to overwrite the default global config. Downloade the “docker config”, add the desired local parameters and feed the file back to the pipeline with the <code class="code docutils literal notranslate"><span class="pre">-C</span></code> flag:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">config</span> <span class="n">mpieva</span><span class="o">/</span><span class="n">quicksand</span> <span class="o">-</span><span class="n">profile</span> <span class="n">docker</span> <span class="o">&gt;</span> <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>
<span class="n">nano</span> <span class="o">~/</span><span class="n">pipeline</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
<p><strong>Add</strong> the parameters introduced above to the <em>params</em> scope. Then run the pipeline with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="o">-</span><span class="n">C</span> <span class="o">~/</span><span class="n">piepline</span><span class="o">/</span><span class="n">nextflow</span><span class="o">.</span><span class="n">config</span>  <span class="n">run</span> <span class="n">mpieva</span><span class="o">/</span><span class="n">quicksand</span> <span class="o">--</span><span class="n">split</span> <span class="n">PATH</span><span class="o">/</span><span class="n">TO</span><span class="o">/</span><span class="n">SPLIT</span><span class="o">/</span><span class="n">DATA</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>when overwriting the default configs, the <code class="code docutils literal notranslate"><span class="pre">-C</span> <span class="pre">nextflow.config</span></code> flag comes before the <code class="code docutils literal notranslate"><span class="pre">run</span> <span class="pre">mpieva/quicksand</span></code> command</p>
</div>
</div>
<div class="section" id="profiles">
<h2>Profiles<a class="headerlink" href="#profiles" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Profiles are a preinstalled set of parameters the pipeline starts with.</div>
<div class="line">The following profiles are available:</div>
</div>
<blockquote>
<div><dl class="simple">
<dt>standard (no profile picked)</dt><dd><p>Run all processes of quicksand in a Singularity container. see the <a class="reference internal" href="#singularity"><span class="std std-ref">Singularity</span></a> section for more infos</p>
</dd>
<dt>conda</dt><dd><p>The non-containerized pipeline. All processes are executed with locally installed software and conda. Since the pipeline relies on some MPI-inhouse-packages that are not published on conda, it is not impossible to run the pipeline (see the <a class="reference internal" href="#conda"><span class="std std-ref">Conda</span></a> section) with this profile outside the MPI EVA, but we highly recommend sticking to Singularity or Docker.</p>
</dd>
<dt>docker</dt><dd><p>Run all processes of quicksand in a Docker container. see the <a class="reference internal" href="#singularity"><span class="std std-ref">Singularity</span></a> section for more infos</p>
</dd>
<dt>cluster</dt><dd><p>execute certain CPU-intensive processes on SGE cluster. <strong>Be aware</strong>: Because of the enourmous amount of intermediate files that nextflow creates and thus a lot of copying between shared drives, we recommend running quicksand without SGE on a local SSD-Drive (or even better: RAM-disc)!. Since experiences may vary, we still kept the option of running the pipeline on a cluster.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="environmental-variables">
<h2>Environmental variables<a class="headerlink" href="#environmental-variables" title="Permalink to this headline">¶</a></h2>
<p>Environmental variables can be set to reduce the number of arguments handed over to the pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pipeline</span><span class="o">-</span><span class="n">variables</span>
<span class="n">QS_DB</span>        <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span>     <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="o">--</span><span class="n">db</span> <span class="n">flag</span>
<span class="n">QS_GENOME</span>    <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span>     <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="o">--</span><span class="n">genome</span> <span class="n">flag</span>
<span class="n">QS_BEDFILES</span>  <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span>     <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="o">--</span><span class="n">bedfiles</span> <span class="n">flag</span>
<span class="n">QS_SPECMAP</span>   <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span>     <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="o">--</span><span class="n">bedfiles</span> <span class="n">flag</span>

<span class="n">useful</span> <span class="n">nextflow</span><span class="o">-</span><span class="n">variables</span>
<span class="n">NXF_SINGULARITY_CACHEDIR</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span> <span class="n">Where</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">pulled</span> <span class="n">Singularity</span><span class="o">-</span><span class="n">images</span>
<span class="n">NXF_WORK</span>                 <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span> <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="o">-</span><span class="n">w</span> <span class="n">flag</span>
<span class="n">NXF_OPTS</span>                 <span class="o">&lt;</span><span class="n">ARGS</span><span class="o">&gt;</span> <span class="n">Hand</span> <span class="n">args</span> <span class="n">over</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Java</span> <span class="n">Virtual</span> <span class="n">Machine</span><span class="o">.</span>
                         <span class="n">In</span> <span class="n">case</span> <span class="n">of</span> <span class="n">a</span> <span class="n">heap</span><span class="o">-</span><span class="n">space</span> <span class="n">error</span><span class="p">,</span> <span class="n">assign</span> <span class="n">more</span> <span class="n">space</span> <span class="k">with</span> <span class="n">the</span>
                         <span class="n">Arguments</span><span class="p">:</span> <span class="s2">&quot;-Xms128g -Xmx128g&quot;</span> <span class="p">(</span><span class="n">allocates</span> <span class="mi">128</span><span class="n">GB</span> <span class="n">heap</span><span class="o">-</span><span class="n">space</span> <span class="k">for</span> <span class="n">the</span> <span class="n">run</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead of working with <code class="file docutils literal notranslate"><span class="pre">nextflow.config</span></code> files, set the desired environmental variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">QS_DB</span><span class="o">=</span><span class="s2">&quot;~/pipeline/data/kraken/Mito_db_kmer22&quot;</span>
<span class="n">export</span> <span class="n">QS_GENOME</span><span class="o">=</span><span class="s2">&quot;~/pipeline/data/genomes&quot;</span>
<span class="n">export</span> <span class="n">QS_BEDFILES</span><span class="o">=</span><span class="s2">&quot;~/pipeline/data/masked/&quot;</span>
<span class="n">export</span> <span class="n">NXF_SINGULARITY_CACHEDIR</span><span class="o">=</span><span class="s2">&quot;~/pipeline/singularity/&quot;</span>
</pre></div>
</div>
<p>And run the pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="n">mpieva</span><span class="o">/</span><span class="n">quicksand</span> <span class="o">--</span><span class="n">split</span> <span class="n">PATH</span><span class="o">/</span><span class="n">TO</span><span class="o">/</span><span class="n">INPUT</span><span class="o">/</span><span class="n">DATA</span>
</pre></div>
</div>
</div>
<div class="section" id="singularity">
<span id="id1"></span><h2>Singularity<a class="headerlink" href="#singularity" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">To cite the Nextflow-docs <a class="reference internal" href="#nxf-docs" id="id2"><span>[nxf_docs]</span></a>:</div>
<div class="line">“Singularity is a container engine alternative to Docker. The main advantages of Singularity is that it can be used with unprivileged permissions and doesn’t require a separate daemon process. These, along other features, like for example the support for autofs mounts, makes Singularity a container engine better suited the requirements of HPC workloads. Singularity is able to use existing Docker images, and pull from Docker registries.”</div>
</div>
<p>So both the <code class="code docutils literal notranslate"><span class="pre">standard</span></code> and the <code class="code docutils literal notranslate"><span class="pre">docker</span></code> profiles use the same container to run the processes of the pipeline in. The image used to construct the containers is hosted on <a class="reference external" href="https://hub.docker.com/repository/docker/merszym/quicksand">dockerhub</a> and automatically pulled by the pipeline upon request (by running the pipeline). The Dockerfile used to create the image is hosted in the repository as well, see: <code class="file docutils literal notranslate"><span class="pre">quicksand/docker/Dockerfile</span></code></p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>When running the pipeline with Singularity make sure that you:</p>
<blockquote>
<div><dl class="simple">
<dt>Bind the paths</dt><dd><p>It happens that singularity is configured in a way that doesnt allow the automated mounting of paths into the container as intended by nextflow. If that is the case and files are either accessed or written to a shared drive, the process might crash and the pipeline exits with a <strong>Path/File not found</strong> error. If that is the case, make sure to add the path via the <code class="code docutils literal notranslate"><span class="pre">runOptions</span> <span class="pre">&quot;--bind</span> <span class="pre">PATH&quot;</span></code> to the <em>singularity</em> scope of your nextflow-config file in a way described in the <a class="reference internal" href="#config"><span class="std std-ref">config section</span></a></p>
</dd>
<dt>Set a cacheDir</dt><dd><p>By default, nextflow downloads the Singularity image into the <code class="file docutils literal notranslate"><span class="pre">work/singularity</span></code> folder of your run. Since downloading and storing the image takes time and disc-space, it is recommended to set up a Singularity cacheDir. This can be done either by adding the <code class="code docutils literal notranslate"><span class="pre">cacheDir</span> <span class="pre">PATH</span></code> argument to the <em>singularity</em> scope of the custom <code class="file docutils literal notranslate"><span class="pre">nextflow.config</span></code> file (see <a class="reference internal" href="#config"><span class="std std-ref">above</span></a>). or by setting the environmental variable <code class="code docutils literal notranslate"><span class="pre">export</span> <span class="pre">NXF_SINGULARITY_CACHEDIR=PATH</span></code> before the run. With the directory set, Singularity will reuse your image.</p>
</dd>
</dl>
</div></blockquote>
</div>
<dl class="citation">
<dt class="label" id="nxf-docs"><span class="brackets"><a class="fn-backref" href="#id2">nxf_docs</a></span></dt>
<dd><p><a class="reference external" href="https://www.nextflow.io/docs/latest/singularity.html">https://www.nextflow.io/docs/latest/singularity.html</a></p>
</dd>
</dl>
</div>
<div class="section" id="conda">
<span id="id3"></span><h2>Conda<a class="headerlink" href="#conda" title="Permalink to this headline">¶</a></h2>
<p>WIP</p>
</div>
<div class="section" id="intermediate-files">
<span id="work"></span><h2>Intermediate files<a class="headerlink" href="#intermediate-files" title="Permalink to this headline">¶</a></h2>
<p>To run all processes separate from each other Nextflow creates a lot of intermediate files and directories that are stored within the runDir in the <code class="file docutils literal notranslate"><span class="pre">work</span></code> directory. Since the file-tree inside the <code class="file docutils literal notranslate"><span class="pre">work</span></code> directory consumes much more disc-space than the whole “real” output of the pipeline, we recommend to delete the folder after the run. This can be either done over the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">fr</span> <span class="n">work</span><span class="o">/</span>
</pre></div>
</div>
<p>or via the <code class="code docutils literal notranslate"><span class="pre">nextflow</span> <span class="pre">clean</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">clean</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">q</span>
</pre></div>
</div>
<p>to also remove hidden logs</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="contribute.html" class="btn btn-neutral float-right" title="Contribute" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="usage.html" class="btn btn-neutral float-left" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, MPI EVA.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>