manifest {
    homePage = 'https://mpieva.github.io/quicksand/'
    description = 'A quick analysis of sedimentary ancient DNA'
    nextflowVersion = '>=20.04'
    version = 'v1.3'
}

trace {
    enabled = true
    file = 'reports/trace.tsv'
}

timeline {
    enabled = true
    file = 'reports/timeline.html'
}

report {
    enabled = true
    file = 'reports/report.html'
}

executor {
    name = 'sge'
    queueSize = 250
    pollInterval = '30 sec'
}

profiles {
    conda {
        process {
            conda = "$baseDir/envs/sediment.yaml"
            executor = 'local'
            errorStrategy = 'retry'
            maxRetries = 5
        }
    }

    docker {
        docker.enabled = true
        process {
            container = 'merszym/quicksand:1.2'
            errorStrategy = 'retry'
            executor = 'local'
            maxRetries = 5
        }
        params{
            bwa      = 'bwa'
            bamrmdup = 'bam-rmdup'
            kraken_uniq = '/usr/local/krakenuniq/'
        }
    }
    standard {
        singularity.enabled = true
        singularity.autoMounts = true
        process {
            container = 'merszym/quicksand:1.2'
            errorStrategy = 'retry'
            executor = 'local'
            maxRetries = 5
            withName:dedupBam {
                container = 'merszym/biohazard_bamrmdup:v0.2'
            }
            withName:fastq2Bam{
                container = 'https://depot.galaxyproject.org/singularity/samtools:1.15.1--h1170115_0'
            }
            withName:toFasta{
                container = 'https://depot.galaxyproject.org/singularity/samtools:1.15.1--h1170115_0'
            }
            withName:splitStats{
                container = 'https://depot.galaxyproject.org/singularity/samtools:1.15.1--h1170115_0'
            }
        }
        params{
            bwa      = 'bwa'
            bamrmdup = 'bam-rmdup'
            kraken_uniq = '/usr/local/krakenuniq/'
        }
    }
    
    cluster {
        process {
            conda = "$baseDir/envs/sediment.yaml"
            withLabel: '!local' {
                executor = 'sge'
                penv = 'smp'
                queue = 'all.q'
                clusterOptions = '-m n'
                errorStrategy = 'retry'
                maxRetries = 5
            }
            withLabel: local {
                executor = 'local'
                errorStrategy = 'retry'
                maxRetries = 5
            }
        }
    }
}
